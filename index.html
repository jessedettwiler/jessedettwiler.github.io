<script>
  // =========================================================
  // SPLASH (photo-first entrance)
  // =========================================================
  const splash = document.getElementById("splash");
  const enterBtn = document.getElementById("enterBtn");

  // If splash exists, activate splash mode
  if (splash) {
    document.body.classList.add("has-splash", "no-scroll");
  }

  function dismissSplash() {
    if (!splash || splash.classList.contains("is-hidden")) return;
    splash.classList.add("is-hidden");
    document.body.classList.remove("has-splash", "no-scroll");
  }

  if (enterBtn) enterBtn.addEventListener("click", (e) => {
    e.stopPropagation();
    dismissSplash();
  });

  if (splash) splash.addEventListener("click", dismissSplash);

  window.addEventListener("wheel", () => dismissSplash(), { passive: true });
  window.addEventListener("touchstart", () => dismissSplash(), { passive: true });
  window.addEventListener("keydown", (e) => {
    if (["Enter", " ", "Escape"].includes(e.key)) dismissSplash();
  });

  // =========================================================
  // MODALS (Bio / Folk-Hop / Playlists / Contact / Mobile Menu)
  // =========================================================
  const openers = document.querySelectorAll("[data-modal-open]");

  function openModalById(id) {
    const m = document.getElementById(id);
    if (!m) return;
    m.classList.add("is-open");
    m.setAttribute("aria-hidden", "false");
    document.body.classList.add("no-scroll");

    // focus close button for accessibility
    const closeBtn = m.querySelector("[data-modal-close]");
    if (closeBtn) closeBtn.focus();
  }

  function closeModal(m) {
    if (!m) return;
    m.classList.remove("is-open");
    m.setAttribute("aria-hidden", "true");

    // Remove no-scroll only if splash is gone AND no other modal is open
    const anyOpen = document.querySelector(".modal.is-open");
    const splashActive = document.body.classList.contains("has-splash");
    if (!anyOpen && !splashActive) {
      document.body.classList.remove("no-scroll");
    }
  }

  // Open modal buttons
  openers.forEach(btn => {
    btn.addEventListener("click", () => {
      openModalById(btn.dataset.modalOpen);
    });
  });

  // Close modal: any element with data-modal-close
  document.addEventListener("click", (e) => {
    const closeEl = e.target.closest("[data-modal-close]");
    if (!closeEl) return;

    const modal = closeEl.closest(".modal");
    closeModal(modal);
  });

  // Also close modal if you click on a link inside the menu modal
  // (we add data-modal-close on those links, but this is extra safety)
  document.addEventListener("click", (e) => {
    const link = e.target.closest("a[data-modal-close]");
    if (!link) return;

    const modal = link.closest(".modal");
    closeModal(modal);
  });

  // ESC closes the topmost open modal (and doesn't break splash)
  document.addEventListener("keydown", (e) => {
    if (e.key !== "Escape") return;
    const open = document.querySelector(".modal.is-open");
    if (open) closeModal(open);
  });

  // Prevent background scroll on iOS when modal is open
  document.addEventListener("touchmove", (e) => {
    const anyOpen = document.querySelector(".modal.is-open");
    if (anyOpen || document.body.classList.contains("has-splash")) {
      e.preventDefault();
    }
  }, { passive: false });
</script>
